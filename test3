pipeline {
  agent {
    node {
      label 'DEBIAN8'
    }
  }
    triggers {
        cron('H */4 * * 1-5')
    }
  environment {
    ARTIFACTORY_URL = 'https://path.to.artifacts/some-registry'
  }
  options {
    disableConcurrentBuilds()   // åŒä¸€æ—¶é—´æœ€å¤šåªå…è®¸ä¸€ä¸ªpipelineè¿è¡Œï¼Œå¦‚æœå‰é¢çš„ä»åœ¨è¿è¡Œï¼Œ åé¢çš„å°†ä¼šç­‰å¾…çŠ¶æ€ã€‚
    retry(1)                    // å¤±è´¥äº†ï¼Œé‡è¯•ä¸€æ¬¡ã€‚
    skipStagesAfterUnstable()   // å¦‚æœæŸä¸ªstageä¸ºunstableçŠ¶æ€ï¼Œåˆ™å¿½ç•¥åé¢çš„ä»»åŠ¡ï¼Œç›´æ¥é€€å‡ºã€‚
    timeout(time: 10, unit: 'MINUTES')      // 10åˆ†é’Ÿçš„è¶…æ—¶è®¾ç½®ã€‚
    skipDefaultCheckout()                   //  å¿½ç•¥é»˜è®¤çš„checkoutã€‚
    buildDiscarder(logRotator(numToKeepStr: '10', artifactNumToKeepStr: '1'))   // ä¿ç•™æœ€æ–°çš„10ä¸ªbuild logå’Œ1ä¸ªartifactã€‚
  }
  tools {
    /**
     * Predefined environment variables MAVEN3 and JDK-1.8
     */
    maven 'MAVEN3'
    jdk 'JDK-1.8'
  }
  stages {
    /**
     * Initialization check for Java and Maven
     */
    stage('Initialization') {
      steps {
        sh '''
          java -version
          mvn -version
        '''
      }
    }
    /**
     * Checkout source code from Github on any of the GIT nodes
     */
    stage('Checkout') {
      steps {
        checkout scm
      }
    }
    /**
     * Compile the Maven project
     */
    stage('Build') {
      steps {
        sh 'mvn clean install'
      }
    }
    /**
     * Trigger this in PRs, don't run on master or release branches
     */
    stage('Package') {
      when {
        changeRequest()
      }
      steps {
        sh 'mvn clean package -DskipTests'
      }
    }
    /**
     * Only run this on master and release branches
     */
    stage('Deploy') {
      when {
        branch 'master'
      }
      environment {
        DEPLOYER = credentials('deployer')
      }
      steps {
        sh 'mvn clean deploy'
      }
    }
    /**
     * Clean workspace
     */
    stage('Clean') {
      steps {
        cleanWs()
      }
    }
  }
    post { 
        success {
        sh """curl 'https://oapi.dingtalk.com/robot/send?access_token=${DINGTALK_CREDS_PWD}' \
        -H 'Content-Type: application/json' \
        -d '{"msgtype": "text","text": {"content": "ğŸ˜„ğŸ‘æ„å»ºæˆåŠŸğŸ‘ğŸ˜„\n å…³é”®å­—ï¼šluffy\n é¡¹ç›®åç§°: ${JOB_BASE_NAME}\n Commit Id: ${GIT_COMMIT}\n æ„å»ºåœ°å€ï¼š${RUN_DISPLAY_URL}"}}'"""
        }
    
        failure {
        sh """curl 'https://oapi.dingtalk.com/robot/send?access_token=${DINGTALK_CREDS_PWD}' \
        -H 'Content-Type: application/json' \
        -d '{"msgtype": "text","text": {"content": "ğŸ˜–âŒæ„å»ºå¤±è´¥âŒğŸ˜–\n å…³é”®å­—ï¼šluffy\n é¡¹ç›®åç§°: ${JOB_BASE_NAME}\n Commit Id: ${GIT_COMMIT}\n æ„å»ºåœ°å€ï¼š${RUN_DISPLAY_URL}"}}'"""
        }
    
        always {
        sh "printenv"
    }
}